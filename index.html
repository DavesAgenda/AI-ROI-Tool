<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Automation ROI Calculator</title>
  <link rel="icon" type="image/png" href="assets/va-logo-circle.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <style>
    /* ===== Valid Agenda Brand Settings ===== */
    :root {
      --va-primary: #134061;
      --va-secondary: #0f2b45;
      --va-accent: #f48847;
      --va-accent-soft: #f9a66c;
      --va-bg: #0f1f33;
      --va-text: #0d2236;
      --va-border: #d9e1ea;
      --va-panel: #ffffff;
      --va-muted: #526880;
      --va-cream: #f5f7fa;
      --va-line: var(--va-border);
      --va-danger: #c94b4b;
      --va-success: #1c9b6c;
      --va-shadow: 0 26px 90px rgba(19, 64, 97, 0.18);
      --va-radius: 16px;
      --va-spacing: 16px;
      --va-font-heading: "Poppins", "Manrope", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      --va-font-body: "Manrope", "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      --va-font: var(--va-font-body);
    }

    /* Footer styling (scoped to calculator) */
    #va-roi-calculator .va-site-footer {
      margin: 36px auto 0;
      padding: 32px;
      background: #0f3555;
      border-radius: 20px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.16);
      color: #f5f9ff;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    #va-roi-calculator .va-site-footer-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 28px 40px;
      align-items: flex-start;
    }

    #va-roi-calculator .va-site-footer-brand {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: flex-start;
    }

    #va-roi-calculator .va-site-footer-brand img {
      width: 160px;
      height: auto;
      object-fit: contain;
      filter: drop-shadow(0 12px 28px rgba(0,0,0,0.25));
    }

    #va-roi-calculator .va-site-footer-tagline {
      margin: 0;
      color: #f9a66c;
      font-weight: 700;
      letter-spacing: 0.4px;
    }

    #va-roi-calculator .va-site-footer h4 {
      margin: 0 0 8px;
      font-size: 1.05rem;
      letter-spacing: 0.4px;
      color: #f48847;
    }

    #va-roi-calculator .va-site-footer p {
      margin: 4px 0;
      color: #eef4fb;
      line-height: 1.6;
    }

    #va-roi-calculator .va-site-footer a {
      color: #f9a66c;
      text-decoration: none;
      font-weight: 600;
    }

    #va-roi-calculator .va-site-footer a:hover {
      color: #f7c08f;
      text-decoration: underline;
    }

    #va-roi-calculator .va-site-footer-contact {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    #va-roi-calculator .va-site-footer-social {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 8px;
    }

    #va-roi-calculator .va-site-footer-social a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f5f9ff;
      color: #0f3555;
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }

    #va-roi-calculator .va-site-footer-bottom {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid rgba(245, 249, 255, 0.18);
      color: #d9e4f2;
      flex-wrap: wrap;
      font-size: 0.95rem;
    }

    #va-roi-calculator .va-site-footer-links {
      display: flex;
      gap: 14px;
      align-items: center;
      flex-wrap: wrap;
    }

    @media (max-width: 640px) {
      #va-roi-calculator .va-site-footer {
        padding: 26px;
      }
      #va-roi-calculator .va-site-footer-bottom {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* Scoped styling tuned to Valid Agenda brand */
    #va-roi-calculator {
      background: linear-gradient(135deg, rgba(19, 64, 97, 0.92), rgba(19, 64, 97, 0.82) 18%, rgba(15, 31, 51, 0.88)),
        radial-gradient(circle at 20% 20%, rgba(244, 136, 71, 0.15), transparent 40%),
        radial-gradient(circle at 80% 0%, rgba(255, 255, 255, 0.08), transparent 26%);
      color: var(--va-text);
      padding: 24px 0;
      font-family: var(--va-font-body);
    }

    #va-roi-calculator .va-roi {
      font-family: var(--va-font-body);
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.05), rgba(244, 136, 71, 0.08)), var(--va-bg);
      color: var(--va-text);
      min-height: 100vh;
      margin: 0;
      padding: 48px 18px 80px;
      box-sizing: border-box;
      scroll-behavior: smooth;
      font-size: 16px;
      line-height: 1.6;
    }

    #va-roi-calculator .va-shell {
      max-width: 1180px;
      margin: 0 auto 90px;
      background: var(--va-panel);
      border: 1px solid rgba(217, 225, 234, 0.9);
      box-shadow: var(--va-shadow);
      border-radius: 24px;
      padding: 36px;
      position: relative;
      overflow: hidden;
      isolation: isolate;
      backdrop-filter: blur(4px);
    }

    #va-roi-calculator .va-shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        linear-gradient(120deg, rgba(19, 64, 97, 0.12), transparent 42%, rgba(244, 136, 71, 0.09) 100%),
        linear-gradient(-8deg, rgba(19, 64, 97, 0.08), transparent 50%);
      opacity: 0.7;
      z-index: 0;
      pointer-events: none;
    }

    #va-roi-calculator .va-shell > * {
      position: relative;
      z-index: 1;
    }

    #va-roi-calculator .va-hero {
      max-width: 1180px;
      margin: 0 auto 28px;
      padding: 0 6px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    #va-roi-calculator .va-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }

    #va-roi-calculator .va-hero .va-title {
      color: #fff;
    }

    #va-roi-calculator .va-hero .va-lede {
      color: rgba(255, 255, 255, 0.82);
    }

    #va-roi-calculator .va-hero .va-tagline {
      color: rgba(255, 255, 255, 0.72);
    }

    #va-roi-calculator .va-hero .va-tag {
      color: #fff;
      border-color: rgba(244, 136, 71, 0.6);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.18);
    }

    #va-roi-calculator .va-brand {
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
    }

    #va-roi-calculator .va-logo {
      width: 180px;
      height: auto;
      display: block;
      padding: 10px 14px;
      border-radius: 14px;
      background: linear-gradient(120deg, rgba(19, 64, 97, 0.08), rgba(244, 136, 71, 0.08));
      filter: drop-shadow(0 10px 24px rgba(19, 64, 97, 0.14));
      object-fit: contain;
    }

    #va-roi-calculator .va-tagline {
      margin: 0 0 4px;
      font-size: 0.95rem;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      color: var(--va-muted);
      font-weight: 700;
    }

    #va-roi-calculator .va-title {
      margin: 0;
      font-size: 2.2rem;
      letter-spacing: -0.4px;
      font-family: var(--va-font-heading);
      color: var(--va-primary);
    }

    #va-roi-calculator .va-lede {
      color: var(--va-muted);
      margin: 6px 0 0;
      max-width: 720px;
      line-height: 1.5;
    }

    #va-roi-calculator .va-tag {
      padding: 8px 14px;
      background: rgba(244, 136, 71, 0.16);
      border: 1px solid rgba(244, 136, 71, 0.38);
      color: var(--va-primary);
      border-radius: 999px;
      font-size: 0.95rem;
      letter-spacing: 0.2px;
      white-space: nowrap;
      font-weight: 700;
    }

    #va-roi-calculator .va-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    #va-roi-calculator .va-card {
      background: var(--va-panel);
      border-radius: 20px;
      padding: 28px;
      border: 1px solid var(--va-line);
      box-shadow: 0 18px 50px rgba(19, 64, 97, 0.12);
    }

    #va-roi-calculator .va-hero-card {
      box-shadow: 0 22px 60px rgba(0, 0, 0, 0.22);
      border-color: rgba(255, 255, 255, 0.08);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.12)), rgba(15, 31, 51, 0.8);
      color: #fff;
    }

    #va-roi-calculator .va-hero-card h3,
    #va-roi-calculator .va-hero-card h4,
    #va-roi-calculator .va-hero-card p {
      color: #fff !important;
    }

    #va-roi-calculator .va-hero-card ul {
      color: rgba(255, 255, 255, 0.86);
    }

    #va-roi-calculator .va-hero-card .va-info-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.04));
      border: 1px solid rgba(255, 255, 255, 0.24);
      color: #fff;
    }

    #va-roi-calculator .va-hero-card .va-info-card h4 {
      color: #fff;
    }

    #va-roi-calculator .va-hero-card .va-info-card ul {
      color: rgba(255, 255, 255, 0.9);
    }

    #va-roi-calculator .va-hero-card .va-info-card li::marker {
      color: rgba(255, 255, 255, 0.7);
    }

    #va-roi-calculator .va-hero-card .va-proceed {
      background: linear-gradient(135deg, var(--va-accent), var(--va-accent-soft));
      color: #fff;
      border: none;
      box-shadow: 0 14px 30px rgba(244, 136, 71, 0.32);
    }

    #va-roi-calculator .va-card h3 {
      margin: 0 0 12px;
      font-size: 1.3rem;
      color: var(--va-primary);
      font-weight: 800;
      letter-spacing: -0.2px;
      font-family: var(--va-font-heading);
    }

    #va-roi-calculator .va-card p {
      margin: 6px 0 12px;
      color: var(--va-muted);
      line-height: 1.5;
      font-size: 0.95rem;
    }

    #va-roi-calculator .va-field {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 18px;
    }

    #va-roi-calculator .va-field label {
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      color: var(--va-primary);
    }

    #va-roi-calculator .va-field small {
      color: var(--va-muted);
      font-weight: 400;
    }

    #va-roi-calculator .va-lead-form {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 6px;
    }

    #va-roi-calculator .va-checkbox {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      justify-content: flex-start;
      text-align: left;
      font-size: 0.95rem;
      color: var(--va-primary);
    }

    #va-roi-calculator .va-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-top: 3px;
      accent-color: var(--va-accent);
      cursor: pointer;
    }

    #va-roi-calculator .va-inline-note {
      color: var(--va-muted);
      font-size: 0.9rem;
      margin-top: -4px;
    }

    #va-roi-calculator .va-lead-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    #va-roi-calculator .va-form-status {
      font-size: 0.95rem;
    }

    #va-roi-calculator .va-form-status.success { color: var(--va-success); }
    #va-roi-calculator .va-form-status.error { color: var(--va-danger); }

    #va-roi-calculator .va-download-banner {
      background: linear-gradient(135deg, #134061, #0f2b45);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 28px 60px rgba(19, 64, 97, 0.35);
    }

    #va-roi-calculator .va-download-banner p {
      color: #fff;
    }

    #va-roi-calculator .va-download-heading {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.4rem;
      font-weight: 800;
    }

    #va-roi-calculator .va-download-grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 16px;
      align-items: start;
    }

    #va-roi-calculator .va-download-grid .va-field-role,
    #va-roi-calculator .va-download-grid .va-field-email {
      grid-column: 1 / -1;
    }

    #va-roi-calculator .va-field.va-consent {
      align-items: flex-start;
    }

    #va-roi-calculator .va-field.va-consent .va-checkbox {
      align-items: center;
      justify-content: flex-start;
    }

    #va-roi-calculator .va-field.va-consent .va-checkbox span {
      display: block;
      text-align: left;
    }

    #va-roi-calculator .va-download-note {
      color: #fff;
      font-size: 1rem;
      margin: 6px 0 10px;
    }

    #va-roi-calculator .va-download-cta {
      background: #f48847;
      border-color: #f9a66c;
      color: #fff;
    }

    #va-roi-calculator .va-next-strip {
      background: #f5f7fa;
      border: 1px dashed var(--va-line);
      box-shadow: none;
    }

    @media (max-width: 768px) {
      #va-roi-calculator .va-download-grid {
        grid-template-columns: 1fr;
      }
    }

    #va-roi-calculator .va-input,
    #va-roi-calculator .va-select {
      background: var(--va-cream);
      border: 1px solid var(--va-line);
      color: var(--va-text);
      padding: 14px 16px;
      border-radius: 10px;
      font-size: 1rem;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    #va-roi-calculator .va-input:focus,
    #va-roi-calculator .va-select:focus {
      border-color: var(--va-accent);
      background: var(--va-panel);
      box-shadow: 0 0 0 3px rgba(244, 136, 71, 0.22);
    }

    #va-roi-calculator .va-toggle {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    #va-roi-calculator .va-btn {
      background: var(--va-panel);
      border: 1px solid var(--va-line);
      color: var(--va-primary);
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.15s ease;
      font-weight: 600;
    }

    #va-roi-calculator .va-btn:hover {
      background: rgba(19, 64, 97, 0.06);
    }

    #va-roi-calculator .va-btn.active {
      background: var(--va-accent);
      color: #fff;
      border-color: var(--va-accent);
      box-shadow: 0 10px 25px rgba(244, 136, 71, 0.25);
    }

    #va-roi-calculator .va-highlight {
      background: var(--va-cream);
      border: 1px solid var(--va-line);
      border-radius: 16px;
      padding: 18px;
      margin-top: 10px;
      box-shadow: 0 12px 30px rgba(19, 64, 97, 0.08);
    }

    #va-roi-calculator .va-highlight strong {
      font-size: 1.1rem;
    }

    /* ===== PDF Template Styles ===== */
    #pdf-root {
      position: fixed;
      left: -9999px;
      top: 0;
      width: 1px;
      height: 1px;
      overflow: hidden;
      opacity: 0;
      pointer-events: none;
      font-family: "Manrope", "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
    }

    .pdf-page {
      width: 900px;
      min-height: 1200px;
      padding: 40px 48px;
      box-sizing: border-box;
      background: #f7f9fb;
      color: #0d2236;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .pdf-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      padding: 14px 16px;
      background: #134061;
      color: #fff;
      border-radius: 14px;
    }

    .pdf-header img {
      height: 36px;
      width: auto;
      object-fit: contain;
    }

    .pdf-subheader {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: #526880;
    }

    .pdf-hero {
      background: #ffffff;
      border: 1px solid #e1e7ef;
      border-radius: 16px;
      padding: 18px 20px;
    }

    .pdf-title {
      margin: 0 0 6px;
      font-size: 22px;
      color: #134061;
      font-weight: 800;
    }

    .pdf-lede {
      margin: 0;
      color: #526880;
      font-size: 14px;
    }

    .pdf-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }

    .pdf-card {
      background: #fff;
      border: 1px solid #e1e7ef;
      border-radius: 14px;
      padding: 14px;
    }

    .pdf-card h4 {
      margin: 0 0 4px;
      font-size: 14px;
      color: #134061;
    }

    .pdf-card .metric {
      font-size: 20px;
      font-weight: 800;
      color: #f48847;
    }

    .pdf-section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      font-weight: 800;
      color: #134061;
      margin: 8px 0 6px;
    }

    .pdf-section-title::before {
      content: "";
      display: inline-block;
      width: 8px;
      height: 22px;
      background: #f48847;
      border-radius: 4px;
    }

    .pdf-opportunities {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
    }

    .pdf-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(244, 136, 71, 0.1);
      color: #f48847;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      font-weight: 700;
    }

    .pdf-cta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      background: #134061;
      color: #fff;
      border-radius: 16px;
      padding: 18px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .pdf-button {
      display: inline-block;
      background: #f48847;
      color: #fff;
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: 800;
      text-decoration: none;
      font-size: 13px;
    }

    .pdf-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #526880;
      margin-top: auto;
    }

    .pdf-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border: 1px solid #e1e7ef;
      border-radius: 12px;
      overflow: hidden;
      font-size: 12px;
    }

    .pdf-table th {
      background: #f5f7fa;
      text-align: left;
      padding: 10px;
      color: #134061;
      font-weight: 800;
      border-bottom: 1px solid #e1e7ef;
    }

    .pdf-table td {
      padding: 10px;
      border-bottom: 1px solid #eef2f7;
      color: #0d2236;
    }

    .pdf-table tr:nth-child(even) td {
      background: #f9fbfd;
    }

    .pdf-callout {
      background: #fff;
      border: 1px solid #e1e7ef;
      border-radius: 12px;
      padding: 12px;
      color: #0d2236;
      font-size: 12px;
    }

    .pdf-matrix img {
      width: 100%;
      height: auto;
      border: 1px solid #e1e7ef;
      border-radius: 12px;
      background: #fff;
    }
    #va-roi-calculator .va-matrix {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    #va-roi-calculator .va-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(19, 64, 97, 0.06);
      border: 1px solid var(--va-line);
      font-size: 0.9rem;
      color: var(--va-primary);
      width: fit-content;
    }

    #va-roi-calculator .va-error {
      color: var(--va-danger);
      font-size: 0.9rem;
      margin: 6px 0 0;
    }

    #va-roi-calculator .va-success {
      color: var(--va-success);
      font-weight: 600;
    }

    #va-roi-calculator .va-progress {
      background: rgba(19, 64, 97, 0.06);
      border-radius: 12px;
      border: 1px solid rgba(217, 225, 234, 0.9);
      overflow: hidden;
      height: 12px;
      position: relative;
      margin-top: 8px;
    }

    #va-roi-calculator .va-progress span {
      display: block;
      height: 100%;
      background: linear-gradient(90deg, var(--va-accent), var(--va-accent-soft));
      width: 0%;
      transition: width 0.25s ease;
    }

    #va-roi-calculator .va-chart {
      background: var(--va-cream);
      border-radius: 12px;
      border: 1px solid var(--va-line);
      padding: 12px;
      margin-top: 8px;
    }

    #va-roi-calculator .va-chart-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    #va-roi-calculator .va-bar {
      height: 10px;
      border-radius: 999px;
      background: rgba(19, 64, 97, 0.12);
      overflow: hidden;
      flex: 1;
    }

    #va-roi-calculator .va-bar span {
      display: block;
      height: 100%;
      background: var(--va-accent);
      width: 0%;
      transition: width 0.25s ease;
    }

    #va-roi-calculator .va-badge {
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: inline-block;
    }

    .va-badge.quick { background: rgba(244, 136, 71, 0.14); color: #c05c29; border: 1px solid rgba(244, 136, 71, 0.38); }
    .va-badge.bet { background: rgba(19, 64, 97, 0.12); color: #134061; border: 1px solid rgba(19, 64, 97, 0.32); }
    .va-badge.hobby { background: rgba(15, 31, 51, 0.06); color: var(--va-muted); border: 1px solid rgba(19, 64, 97, 0.16); }
    .va-badge.trap { background: rgba(201, 75, 75, 0.14); color: #a03b3b; border: 1px solid rgba(201, 75, 75, 0.45); }

    #va-roi-calculator .va-footer {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
    }

    #va-roi-calculator .va-cta {
      background: linear-gradient(135deg, var(--va-accent), var(--va-accent-soft));
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      letter-spacing: 0.2px;
      box-shadow: 0 14px 34px rgba(244, 136, 71, 0.32);
    }

    #va-roi-calculator .va-proceed {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 14px;
      padding: 10px 14px;
      background: var(--va-panel);
      border: 1px solid var(--va-line);
      border-radius: 12px;
      color: var(--va-primary);
      font-weight: 700;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    #va-roi-calculator .va-proceed:hover {
      background: rgba(19, 64, 97, 0.06);
      border-color: var(--va-accent);
      color: var(--va-accent);
      box-shadow: 0 10px 24px rgba(19, 64, 97, 0.18);
    }

    #va-roi-calculator .va-table {
      margin-top: 14px;
      border: 1px solid var(--va-line);
      border-radius: 16px;
      overflow: hidden;
      background: #fff;
      box-shadow: 0 12px 30px rgba(15, 53, 85, 0.05);
    }

    #va-roi-calculator .va-table-head,
    #va-roi-calculator .va-table-foot {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr;
      gap: 6px;
      padding: 10px 14px;
      background: var(--va-cream);
      color: var(--va-primary);
      font-weight: 700;
      font-size: 0.95rem;
    }

    #va-roi-calculator .va-table-body {
      display: flex;
      flex-direction: column;
    }

    #va-roi-calculator .va-table-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr;
      gap: 6px;
      padding: 12px 14px;
      border-top: 1px solid var(--va-line);
      align-items: center;
      color: var(--va-primary);
    }

    #va-roi-calculator .va-table-row small {
      color: var(--va-muted);
      display: block;
      font-size: 0.85rem;
      margin-top: 2px;
    }

    #va-roi-calculator .va-table-empty {
      padding: 12px 14px;
      color: var(--va-muted);
      text-align: left;
    }

    @media (max-width: 768px) {
      #va-roi-calculator .va-table-head,
      #va-roi-calculator .va-table-row,
      #va-roi-calculator .va-table-foot {
        grid-template-columns: 1.6fr 1fr 1fr;
        grid-auto-rows: auto;
        grid-template-areas:
          "task task task"
          "owner weekly annual"
          "cost savings empty";
      }

      #va-roi-calculator .va-table-head span:nth-child(1),
      #va-roi-calculator .va-table-row span:nth-child(1),
      #va-roi-calculator .va-table-foot strong:nth-child(1) { grid-area: task; }
      #va-roi-calculator .va-table-head span:nth-child(2),
      #va-roi-calculator .va-table-row span:nth-child(2),
      #va-roi-calculator .va-table-foot span:nth-child(2) { grid-area: owner; }
      #va-roi-calculator .va-table-head span:nth-child(3),
      #va-roi-calculator .va-table-row span:nth-child(3),
      #va-roi-calculator .va-table-foot span:nth-child(3) { grid-area: weekly; }
      #va-roi-calculator .va-table-head span:nth-child(4),
      #va-roi-calculator .va-table-row span:nth-child(4),
      #va-roi-calculator .va-table-foot span:nth-child(4) { grid-area: annual; }
      #va-roi-calculator .va-table-head span:nth-child(5),
      #va-roi-calculator .va-table-row span:nth-child(5),
      #va-roi-calculator .va-table-foot span:nth-child(5) { grid-area: cost; }
      #va-roi-calculator .va-table-head span:nth-child(6),
      #va-roi-calculator .va-table-row span:nth-child(6),
      #va-roi-calculator .va-table-foot span:nth-child(6) { grid-area: savings; }
    }

    #va-roi-calculator .va-zone {
      position: absolute;
      width: 50%;
      height: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-weight: 700;
      font-size: 0.95rem;
      color: rgba(19, 64, 97, 0.35);
      z-index: 0;
      pointer-events: none;
    }

    #va-roi-calculator .va-zone.quick { background: rgba(244, 136, 71, 0.16); color: rgba(244, 136, 71, 0.65); }
    #va-roi-calculator .va-zone.bet { background: rgba(19, 64, 97, 0.12); color: rgba(19, 64, 97, 0.72); }
    #va-roi-calculator .va-zone.hobby { background: rgba(15, 31, 51, 0.08); color: rgba(82, 104, 128, 0.8); }
    #va-roi-calculator .va-zone.trap { background: rgba(201, 75, 75, 0.12); color: rgba(160, 59, 59, 0.8); }

    #va-roi-calculator .va-zone.quick { right: 0; bottom: 0; }
    #va-roi-calculator .va-zone.bet { right: 0; top: 0; }
    #va-roi-calculator .va-zone.hobby { left: 0; bottom: 0; }
    #va-roi-calculator .va-zone.trap { left: 0; top: 0; }

    #va-roi-calculator .va-ready-layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
      align-items: start;
    }

    #va-roi-calculator .va-info-card {
      background: var(--va-cream);
      border: 1px dashed var(--va-line);
      border-radius: var(--va-radius);
      padding: 14px;
      color: var(--va-primary);
    }

    #va-roi-calculator .va-info-card h4 {
      margin: 0 0 8px;
      font-size: 1rem;
    }

    #va-roi-calculator .va-info-card ul {
      margin: 0;
      padding-left: 18px;
      color: var(--va-muted);
      line-height: 1.5;
    }

    #va-roi-calculator .va-chip-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      align-items: center;
    }

    #va-roi-calculator .va-chip {
      border: 1px solid var(--va-line);
      background: var(--va-cream);
      color: var(--va-primary);
      padding: 10px 12px;
      border-radius: 999px;
      cursor: pointer;
      text-align: center;
      font-weight: 600;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    #va-roi-calculator .va-chip:hover {
      background: rgba(19, 64, 97, 0.06);
      border-color: rgba(244, 136, 71, 0.4);
      color: var(--va-accent);
    }

    #va-roi-calculator .va-chip.active {
      background: linear-gradient(135deg, var(--va-accent), var(--va-accent-soft));
      color: #fff;
      border-color: var(--va-accent);
      box-shadow: 0 10px 24px rgba(244, 136, 71, 0.28);
    }

    #va-roi-calculator .va-ready-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
      align-items: stretch;
    }

    #va-roi-calculator .inventory-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      align-items: start;
    }

    #va-roi-calculator .readiness-grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    #va-roi-calculator .readiness-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #va-roi-calculator .va-ready-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    #va-roi-calculator .task-form-grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 40px;
      align-items: start;
    }

    #va-roi-calculator .readiness-card {
      background: var(--va-cream);
      border: 1px solid var(--va-line);
      border-radius: 12px;
      padding: 26px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    #va-roi-calculator .readiness-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    #va-roi-calculator .readiness-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    @media (max-width: 900px) {
      #va-roi-calculator .task-form-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      #va-roi-calculator .va-ready-item {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    #va-roi-calculator .va-ready-label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      color: var(--va-primary);
    }

    #va-roi-calculator .va-info {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 1px solid var(--va-muted);
      color: var(--va-primary);
      font-size: 0.75rem;
      cursor: help;
      background: var(--va-panel);
    }

    #va-roi-calculator .va-switch {
      position: relative;
      width: 52px;
      height: 26px;
      border-radius: 999px;
      border: none;
      background: rgba(19, 64, 97, 0.12);
      cursor: pointer;
      padding: 0;
      transition: all 0.2s ease;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
    }

    #va-roi-calculator .va-switch-thumb {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.16);
    }

    #va-roi-calculator .va-switch.on {
      background: linear-gradient(135deg, var(--va-accent), var(--va-accent-soft));
      box-shadow: 0 6px 18px rgba(244, 136, 71, 0.35);
    }

    #va-roi-calculator .va-switch.on .va-switch-thumb {
      left: 29px;
    }

    #va-roi-calculator .va-switch:active .va-switch-thumb {
      transform: scale(0.96);
    }

    #va-roi-calculator .soft-card {
      background: var(--va-cream);
      border: 1px solid var(--va-line);
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(19, 64, 97, 0.08);
    }

    #va-roi-calculator .priority-pill {
      display: inline-flex;
      align-items: center;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 0.9rem;
      border: 1px solid transparent;
    }
    #va-roi-calculator .priority-pill.quick { background: rgba(244, 136, 71, 0.14); color: #c05c29; border-color: rgba(244, 136, 71, 0.38); }
    #va-roi-calculator .priority-pill.bet { background: rgba(19, 64, 97, 0.12); color: #134061; border-color: rgba(19, 64, 97, 0.32); }
    #va-roi-calculator .priority-pill.hobby { background: rgba(15, 31, 51, 0.06); color: var(--va-muted); border-color: rgba(19, 64, 97, 0.16); }
    #va-roi-calculator .priority-pill.trap { background: rgba(201, 75, 75, 0.14); color: #a03b3b; border-color: rgba(201, 75, 75, 0.45); }

    #va-roi-calculator .classification-table .va-table-head,
    #va-roi-calculator .classification-table .va-table-row {
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr 1fr;
    }

    #va-roi-calculator .va-info:hover::after,
    #va-roi-calculator .va-info:focus-visible::after {
      content: attr(data-tip);
      position: absolute;
      top: 120%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--va-primary);
      color: #fff;
      padding: 6px 8px;
      border-radius: 8px;
      font-size: 0.8rem;
      line-height: 1.3;
      width: 180px;
      box-shadow: 0 10px 24px rgba(19, 64, 97, 0.24);
      z-index: 10;
      pointer-events: none;
    }

    #va-roi-calculator .va-range-wrap {
      padding: 0 4px;
    }

    #va-roi-calculator input[type="range"],
    #va-roi-calculator .va-range {
      -webkit-appearance: none;
      width: 100%;
      margin: 0;
      height: 10px;
      border-radius: 999px;
      background: rgba(217, 225, 234, 0.85);
      outline: none;
    }

    #va-roi-calculator input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--va-accent), var(--va-accent-soft));
      box-shadow: 0 6px 12px rgba(244, 136, 71, 0.35);
      cursor: pointer;
      border: 2px solid #fff;
    }

    #va-roi-calculator input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--va-accent), var(--va-accent-soft));
      box-shadow: 0 6px 12px rgba(244, 136, 71, 0.35);
      cursor: pointer;
      border: 2px solid #fff;
    }

    #va-roi-calculator input[type="range"]::-webkit-slider-runnable-track {
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--va-accent), var(--va-accent-soft));
    }

    #va-roi-calculator input[type="range"]::-moz-range-track {
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--va-accent), var(--va-accent-soft));
    }

    @media (max-width: 768px) {
      #va-roi-calculator .va-shell { padding: 22px; }
      #va-roi-calculator .va-header { flex-direction: column; }
      #va-roi-calculator .va-title { font-size: 1.75rem; }
      #va-roi-calculator .va-roi { padding: 24px 14px 40px; }
      #va-roi-calculator .va-ready-layout { grid-template-columns: 1fr; }
      #va-roi-calculator .inventory-layout { grid-template-columns: 1fr; }
      #va-roi-calculator .readiness-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div id="va-roi-calculator">
    <div class="va-roi">
      <div id="pdf-root" aria-hidden="true"></div>
      <div class="va-hero">
    <div class="va-header">
      <div class="va-brand">
        <img src="assets/va-logo-wide.png" alt="Valid Agenda logo" class="va-logo" />
        <div>
          <p class="va-tagline">Valid Agenda ROI Toolkit</p>
          <h1 class="va-title">Automation ROI Calculator</h1>
          <p class="va-lede">
            Quickly size the time and cost of recurring work to decide if automation is worth it.
          </p>
        </div>
      </div>
      <div class="va-tag">AI that pays back</div>
    </div>

    <div class="va-card va-hero-card" id="part-1">
      <h3>How this works</h3>
      <div class="va-ready-layout">
        <div class="va-info-card" style="grid-column: span 2;">
          <h4>Use this to capture tasks and rank automation fit</h4>
          <ul>
            <li>List each workflow with time, frequency, and hourly cost.</li>
            <li>Toggle effort factors per task to reflect automation readiness.</li>
            <li>See total time and cost, plus a simple 50% automation savings view.</li>
            <li>Plot tasks by impact and effort to choose what to automate first.</li>
          </ul>
        </div>
      </div>
      <a class="va-proceed" href="#part-2">Start adding tasks</a>
    </div>
  </div>

  <div class="va-shell">

    <div class="va-card" id="part-2" style="margin-top:16px;">
      <h3>Workflow Inventory</h3>
      <p>Add each recurring task, save it, then add another. Effort factors live inside each task.</p>
      <form id="inventory-form" autocomplete="off">
        <div class="task-form-grid">
          <div class="left-col">
            <div class="va-field">
              <label>Task name </label>
              <input class="va-input" id="task-name" type="text" placeholder="e.g., Weekly reporting emails" />
            </div>
            <div class="va-grid" style="grid-template-columns: repeat(auto-fit,minmax(180px,1fr));">
              <div class="va-field">
                <label>Frequency per week</label>
                <input class="va-input" id="freq" type="number" min="0" step="1" placeholder="e.g., 5" />
              </div>
              <div class="va-field">
                <label>Minutes per task</label>
                <input class="va-input" id="minutes" type="number" min="0" step="0.5" placeholder="e.g., 20" />
              </div>
              <div class="va-field">
                <label>Hourly cost of the role ($)</label>
                <input class="va-input" id="hourly" type="number" min="0" step="1" placeholder="e.g., 60" />
              </div>
              <div class="va-field">
                <label>Role title</label>
                <input class="va-input" id="role" type="text" placeholder="e.g., Ops Manager" />
              </div>
            </div>
            <div class="va-field">
              <label style="flex-direction:column; align-items:flex-start; gap:4px;">
                <span>Pain level</span>
                <small title="Why it matters: higher pain means bigger urgency">How disruptive is this work?</small>
              </label>
              <input id="pain" type="hidden" value="5" />
              <div class="va-chip-group" id="pain-chips">
                <button type="button" class="va-chip" data-pain="1" data-label="Minor annoyance">Minor annoyance</button>
                <button type="button" class="va-chip" data-pain="3" data-label="Manageable">Manageable</button>
                <button type="button" class="va-chip" data-pain="5" data-label="Moderate">Moderate</button>
                <button type="button" class="va-chip" data-pain="7" data-label="Disruptive">Disruptive</button>
                <button type="button" class="va-chip" data-pain="10" data-label="Severe impact">Severe impact</button>
              </div>
              <div style="color:var(--va-muted);font-size:0.9rem;margin-top:6px;" hidden="true">Selected: <strong id="pain-display">Moderate</strong></div>
            </div>
          </div>
          <div class="right-col">
            <div class="readiness-card">
              <h3 style="margin:0;">Readiness to automate</h3>
              <p style="margin:0;color:var(--va-muted);font-size:0.95rem;">Turn on what’s true.<br>More on = easier to automate.</p>
              <div id="task-readiness-list" class="va-ready-list readiness-grid" style="margin-top:6px;"></div>
            </div>
          </div>
        </div>
        <div id="form-error" class="va-error" style="display:none;"></div>
      </form>
      <div class="va-footer" style="margin-top:10px;">
        <div style="color:var(--va-muted);">Save each task, then add another to compare.</div>
        <button class="va-cta" id="save-task-btn" type="button">Save task</button>
      </div>
      <div class="va-highlight soft-card" style="margin-top:12px;">
        <strong>Saved tasks</strong>
        <div id="task-list" style="margin-top:10px; display:flex; flex-direction:column; gap:10px;"></div>
        <div id="task-empty" style="color:var(--va-muted); font-size:0.95rem;">No tasks saved yet.</div>
      </div>
      <a class="va-proceed" href="#part-3">View ROI summary</a>
    </div>

    <div class="va-card" id="part-3" style="margin-top:16px;">
      <h3>ROI Summary</h3>
      <p>See time and cost for each saved task, plus a 50% automation savings view.</p>
      <div class="va-highlight soft-card">
        <div style="display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap;align-items:center;">
          <div>
            <div style="color:var(--va-muted);font-size:0.9rem;">Current annual cost</div>
            <div style="font-size:1.5rem;font-weight:800;" id="annual-cost">$0 / year</div>
          </div>
          <div class="va-pill" id="weekly-hours">0 hrs / week</div>
        </div>
        <div class="va-pill" style="margin-top:10px;">Annual hours: <span id="annual-hours" style="margin-left:6px;">0</span></div>
      </div>
      <div class="va-table" aria-live="polite">
        <div class="va-table-head">
          <span>Task</span><span>Owner</span><span>Weekly hrs</span><span>Annual hrs</span><span>Annual cost</span><span>Savings (50%)</span>
        </div>
        <div id="task-table-body" class="va-table-body"></div>
        <div id="task-table-empty" class="va-table-empty">Add tasks to see ROI.</div>
        <div class="va-table-foot" id="task-totals">
          <strong>Totals</strong><span></span><span id="total-weekly">0</span><span id="total-annual">0</span><span id="total-cost">$0</span><span id="total-savings">$0</span>
        </div>
      </div>
      <div class="va-chart">
        <div class="va-chart-bar">
          <span style="width:120px;color:var(--va-muted);font-size:0.9rem;">Current cost</span>
          <div class="va-bar"><span id="cost-bar"></span></div>
        </div>
        <div class="va-chart-bar">
          <span style="width:120px;color:var(--va-muted);font-size:0.9rem;">If automated (50%)</span>
          <div class="va-bar"><span id="savings-bar" style="background:var(--va-accent);"></span></div>
        </div>
        <div style="color:var(--va-muted);font-size:0.9rem;">Estimated savings at 50% automation: <strong id="savings-figure">$0</strong></div>
      </div>
      <a class="va-proceed" href="#part-4">View decision matrix</a>
    </div>

    <div class="va-card" id="part-4" style="margin-top:16px;">
      <h3>Decision Matrix</h3>
      <p>Impact uses annual cost; effort uses your readiness toggles. Hover dots to see details.</p>
      <div class="va-chart soft-card" style="margin-top:12px;">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:6px;">
          <strong>Portfolio view</strong>
          <small style="color:var(--va-muted);">Each dot is a task</small>
        </div>
          <div id="matrix-plot" style="position:relative;">
            <canvas id="decision-matrix-canvas" style="width:100%;max-width:100%;height:360px;display:block;border:1px solid var(--va-line);border-radius:12px;"></canvas>
            <div style="position:absolute;left:8px;top:8px;color:var(--va-muted);font-size:0.85rem;">Effort ↑ (more)</div>
            <div style="position:absolute;right:8px;bottom:8px;color:var(--va-muted);font-size:0.85rem;">Impact →</div>
          </div>
      </div>
      <div class="va-table classification-table" style="margin-top:12px;">
        <div class="va-table-head">
          <span>Task</span><span>Owner</span><span>Impact</span><span>Effort</span><span>Annual cost</span><span>Savings (50%)</span><span>Priority</span>
        </div>
        <div id="classification-table" class="va-table-body"></div>
        <div id="classification-empty" class="va-table-empty">Add tasks to plot them on the matrix.</div>
      </div>
    </div>

    <div class="va-card va-download-banner" id="part-3b" style="margin-top:16px;">
      <div class="va-download-heading">
        <span style="color:#fff;">Download a PDF copy</span>
      </div>
      <p class="va-download-note">Grab your ROI summary PDF and we’ll follow up with a tailored walkthrough.</p>
      <form id="lead-form" class="va-lead-form" novalidate>
        <div class="va-download-grid">
          <div class="va-field">
            <label for="lead-first-name" style="color:#fff;">First name</label>
            <input class="va-input" id="lead-first-name" name="firstName" type="text" placeholder="" required />
          </div>
          <div class="va-field">
            <label for="lead-last-name" style="color:#fff;">Last name</label>
            <input class="va-input" id="lead-last-name" name="lastName" type="text" placeholder="" required />
          </div>
          <div class="va-field va-field-role">
            <label for="lead-role" style="color:#fff;">Role</label>
            <select class="va-select" id="lead-role" name="role" required>
              <option value="" disabled selected hidden>Select a role</option>
              <option>Owner / Founder</option>
              <option>General Manager</option>
              <option>Operations</option>
              <option>Sales</option>
              <option>Marketing</option>
              <option>Finance / Admin</option>
              <option>IT / Technical</option>
              <option>Other</option>
            </select>
          </div>
          <div class="va-field va-field-email">
            <label for="lead-email" style="color:#fff;">Work email</label>
            <input class="va-input" id="lead-email" name="email" type="email" placeholder="you@company.com" required />
          </div>
        </div>
        <div class="va-field va-consent">
          <label class="va-checkbox" for="lead-consent" style="color:#fff;">
            <input id="lead-consent" type="checkbox" />
            <span style="color:#fff;">I agree to receive communications from Valid Agenda about automation ROI and services.</span>
          </label>
        </div>
        <div class="va-lead-actions">
          <button class="va-cta va-download-cta" id="lead-submit" type="submit">Download PDF</button>
          <div id="lead-status" class="va-form-status" role="status" aria-live="polite"></div>
        </div>
      </form>
    </div>

    <div class="va-card va-next-strip" style="margin-top: 16px; box-shadow:none;">
      <h3>Next steps</h3>
      <p>Valid Agenda is here with a range of services to help you get started.</p>
      <div class="va-matrix">
        <div class="va-highlight">
          <strong>Teach</strong>
          <p>Coaching so your team can build simple automations confidently.</p>
        </div>
        <div class="va-highlight">
          <strong>Evaluate</strong>
          <p>ROI-first assessment to find the best opportunities and sequence them.</p>
        </div>
        <div class="va-highlight">
          <strong>Deliver</strong>
          <p>Low or no-code builds that are easy to run and tied to measurable outcomes.</p>
        </div>
      </div>
      <div class="va-footer">
        <div style="color:var(--va-muted);">Want a quick readout? We’ll map the value math to a delivery plan.</div>
        <button class="va-cta" type="button" onclick="window.open('https://validagenda.com/book','_blank','noopener');">Book Your Alignment Call Now</button>
      </div>
    </div>
    </div>
  </div>

  <footer class="va-site-footer">
    <div class="va-site-footer-row">
      <div class="va-site-footer-brand">
        <img src="assets/va-logo-wide.png" alt="Valid Agenda logo">
        <p class="va-site-footer-tagline">TEACH // EVALUATE // DELIVER</p>
      </div>
      <div class="va-site-footer-contact">
        <h4>Contact</h4>
        <p>David Pengelley, Founder</p>
        <p><a href="tel:+61256570400">+61 2 5657 0400</a></p>
        <div class="va-site-footer-social">
          <a href="https://www.linkedin.com/in/davidpen/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true"><path d="M3.29 14H.42V5.2h2.87V14zM1.85 4.03C.83 4.03 0 3.19 0 2.17 0 1.16.83.31 1.85.31c1.01 0 1.85.85 1.85 1.86 0 1.02-.84 1.86-1.85 1.86zM16 14h-2.86v-4.3c0-1.03-.02-2.36-1.44-2.36-1.44 0-1.67 1.12-1.67 2.28V14H7.17V5.2h2.75v1.2h.04c.38-.72 1.3-1.48 2.67-1.48 2.86 0 3.38 1.88 3.38 4.33V14z"/></svg>
          </a>
          <a href="https://www.youtube.com/@ValidAgenda" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M23.5 6.2s-.2-1.7-.8-2.4c-.8-.8-1.6-.8-2-0.8C17.3 2.8 12 2.8 12 2.8h-.1s-5.3 0-8.7.2c-.5.1-1.3.1-2 0.8-.6.7-.8 2.4-.8 2.4S0 8.1 0 10v1.9c0 1.9.2 3.8.2 3.8s.2 1.7.8 2.4c.8.8 1.9.8 2.4.9 1.7.2 7 .2 7 .2s5.3 0 8.7-.2c.5-.1 1.3-.1 2-.8.6-.7.8-2.4.8-2.4s.2-1.9.2-3.8V10c0-1.9-.2-3.8-.2-3.8zM9.6 13.9V8.1l5.2 2.9-5.2 2.9z"/></svg>
          </a>
        </div>
      </div>
      <div class="va-site-footer-location">
        <h4>Location</h4>
        <p>Sydney, NSW</p>
      </div>
    </div>
    <div class="va-site-footer-bottom">
      <p class="va-site-footer-meta">© 2025 Valid Agenda Pty Ltd. All Rights Reserved.</p>
      <div class="va-site-footer-links">
        <a href="https://www.validagenda.com/privacy-policy" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
        <span style="color:#f9a66c;">|</span>
        <a href="https://www.validagenda.com/terms-of-service" target="_blank" rel="noopener noreferrer">Terms of Service</a>
      </div>
    </div>
  </footer>

</div>
</div>

  <script>
    // Encapsulate logic to avoid globals
    (() => {
      const WEBHOOK_URL = "https://hooks.validagenda.dev/webhook/eb31e5cf-774c-4aa1-b914-8b5fa20be96c";
      const MEETING_URL = "https://validagenda.com/book";
      const LOGO_DATA = "assets/va-logo-wide.png";

      const readinessChecks = [
        { id: "documented", label: "Easy to explain", tip: "" },
        { id: "digital", label: "Everything is already digital", tip: "" },
        { id: "repeatable", label: "Happens the same way each time", tip: "" },
        { id: "frequency", label: "Safe to automate", tip: "" },
        { id: "access", label: "Someone can approve it", tip: "" },
      ];

      const els = {
        weeklyHours: document.getElementById("weekly-hours"),
        annualHours: document.getElementById("annual-hours"),
        annualCost: document.getElementById("annual-cost"),
        savingsFigure: document.getElementById("savings-figure"),
        costBar: document.getElementById("cost-bar"),
        savingsBar: document.getElementById("savings-bar"),
        painInput: document.getElementById("pain"),
        painDisplay: document.getElementById("pain-display"),
        painChips: Array.from(document.querySelectorAll("#pain-chips .va-chip")),
        formError: document.getElementById("form-error"),
        saveTaskBtn: document.getElementById("save-task-btn"),
        taskReadinessList: document.getElementById("task-readiness-list"),
        taskList: document.getElementById("task-list"),
        taskEmpty: document.getElementById("task-empty"),
        matrixPlot: document.getElementById("matrix-plot"),
        matrixCanvas: document.getElementById("decision-matrix-canvas"),
        taskTableBody: document.getElementById("task-table-body"),
        taskTableEmpty: document.getElementById("task-table-empty"),
        totalWeekly: document.getElementById("total-weekly"),
        totalAnnual: document.getElementById("total-annual"),
        totalCost: document.getElementById("total-cost"),
        totalSavings: document.getElementById("total-savings"),
        classificationTable: document.getElementById("classification-table"),
        classificationEmpty: document.getElementById("classification-empty"),
        leadForm: document.getElementById("lead-form"),
        leadFirstName: document.getElementById("lead-first-name"),
        leadLastName: document.getElementById("lead-last-name"),
        leadRole: document.getElementById("lead-role"),
        leadEmail: document.getElementById("lead-email"),
        leadConsent: document.getElementById("lead-consent"),
        leadStatus: document.getElementById("lead-status"),
        leadSubmit: document.getElementById("lead-submit"),
        fields: {
          task: document.getElementById("task-name"),
          freq: document.getElementById("freq"),
          minutes: document.getElementById("minutes"),
          hourly: document.getElementById("hourly"),
          role: document.getElementById("role"),
        },
      };

      const state = {
        formReadiness: {},
        values: {
          task: "",
          freq: 0,
          minutes: 0,
          hourly: 0,
          role: "",
          pain: 5,
        },
        tasks: [],
        editingId: null,
      };

      const STORAGE_KEY = "va-roi-state";
      let matrixDots = [];

      function getFormTask() {
        return {
          id: "current",
          task: els.fields.task.value.trim(),
          freq: Number(els.fields.freq.value) || 0,
          minutes: Number(els.fields.minutes.value) || 0,
          hourly: Number(els.fields.hourly.value) || 0,
          role: els.fields.role.value.trim(),
          pain: Number(els.painInput.value) || 5,
          readiness: { ...state.formReadiness },
        };
      }

      function formatCurrency(value) {
        if (!isFinite(value)) return "$0";
        const rounded = Math.round(value);
        const sign = rounded < 0 ? "-" : "";
        return `${sign}$${Math.abs(rounded).toLocaleString()}`;
      }

      function percentOf(max, value) {
        if (max <= 0) return 0;
        return Math.min(100, Math.round((value / max) * 100));
      }

      function validateEmail(value) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(value).trim());
      }

      function setLeadStatus(message, type = "") {
        if (!els.leadStatus) return;
        els.leadStatus.textContent = message || "";
        els.leadStatus.className = "va-form-status" + (type ? ` ${type}` : "");
      }

      function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
        const words = text.split(" ");
        let line = "";
        for (let n = 0; n < words.length; n++) {
          const testLine = line + words[n] + " ";
          const metrics = ctx.measureText(testLine);
          if (metrics.width > maxWidth && n > 0) {
            ctx.fillText(line, x, y);
            line = words[n] + " ";
            y += lineHeight;
          } else {
            line = testLine;
          }
        }
        ctx.fillText(line, x, y);
        return y;
      }

      function drawRoundedRect(ctx, x, y, w, h, r = 16) {
        if (ctx.roundRect) {
          ctx.beginPath();
          ctx.roundRect(x, y, w, h, r);
        } else {
          ctx.beginPath();
          ctx.moveTo(x + r, y);
          ctx.lineTo(x + w - r, y);
          ctx.quadraticCurveTo(x + w, y, x + w, y + r);
          ctx.lineTo(x + w, y + h - r);
          ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
          ctx.lineTo(x + r, y + h);
          ctx.quadraticCurveTo(x, y + h, x, y + h - r);
          ctx.lineTo(x, y + r);
          ctx.quadraticCurveTo(x, y, x + r, y);
        }
      }

      function drawMatrixOnCanvas(ctx, area, tasks) {
        const { x, y, width, height } = area;
        ctx.save();
        ctx.translate(x, y);
        ctx.fillStyle = "#f5f7fa";
        ctx.fillRect(0, 0, width, height);
        ctx.strokeStyle = "#d9e1ea";
        ctx.strokeRect(0, 0, width, height);

        // quadrants
        ctx.fillStyle = "rgba(201,75,75,0.08)";
        ctx.fillRect(0, 0, width / 2, height / 2);
        ctx.fillStyle = "rgba(19,64,97,0.08)";
        ctx.fillRect(width / 2, 0, width / 2, height / 2);
        ctx.fillStyle = "rgba(15,31,51,0.06)";
        ctx.fillRect(0, height / 2, width / 2, height / 2);
        ctx.fillStyle = "rgba(244,136,71,0.12)";
        ctx.fillRect(width / 2, height / 2, width / 2, height / 2);

        ctx.strokeStyle = "#cdd6e0";
        ctx.beginPath();
        ctx.moveTo(width / 2, 0);
        ctx.lineTo(width / 2, height);
        ctx.moveTo(0, height / 2);
        ctx.lineTo(width, height / 2);
        ctx.stroke();

        ctx.fillStyle = "#526880";
        ctx.font = "bold 16px Manrope, Poppins, sans-serif";
        ctx.fillText("Strategic Bet", width * 0.65, height * 0.18);
        ctx.fillText("Trap", width * 0.12, height * 0.18);
        ctx.fillText("Hobby", width * 0.12, height * 0.82);
        ctx.fillText("Quick Win", width * 0.65, height * 0.82);
        ctx.font = "600 14px Manrope, sans-serif";
        ctx.fillText("Effort ↑", 4, 16);
        ctx.fillText("Impact →", width - 90, height - 8);

        const IMPACT_FLOOR = 20000;
        const maxImpact = Math.max(...tasks.map((t) => t.metrics.annualCost), IMPACT_FLOOR);

        tasks.forEach((task) => {
          const impactRatio = Math.min(1, Math.max(0, task.metrics.annualCost / maxImpact));
          const effortRatio = Math.min(1, Math.max(0, (1 - task.readinessScore) + (10 - task.pain) / 25));
          const px = impactRatio * width;
          const py = (1 - effortRatio) * height;
          ctx.beginPath();
          ctx.arc(px, py, 8, 0, Math.PI * 2);
          const badge = task.priorityClass;
          ctx.fillStyle =
            badge === "quick" ? "#f48847" : badge === "bet" ? "#134061" : badge === "trap" ? "#c94b4b" : "rgba(82,104,128,0.9)";
          ctx.fill();
          ctx.lineWidth = 2;
          ctx.strokeStyle = "#fff";
          ctx.stroke();
        });

        ctx.restore();
      }

      function loadImage(src) {
        return new Promise((resolve) => {
          const img = new Image();
          img.crossOrigin = "anonymous";
          img.onload = () => resolve(img);
          img.onerror = () => resolve(null);
          img.src = src;
        });
      }

      async function loadQrImage(url) {
        try {
          const res = await fetch(`https://api.qrserver.com/v1/create-qr-code/?size=340x340&data=${encodeURIComponent(url)}`);
          const blob = await res.blob();
          const objectUrl = URL.createObjectURL(blob);
          const img = await loadImage(objectUrl);
          URL.revokeObjectURL(objectUrl);
          return img;
        } catch (err) {
          console.error("QR load failed", err);
          return null;
        }
      }

      function dataUrlToUint8(dataUrl) {
        const [, data = ""] = String(dataUrl).split(",");
        const binary = atob(data);
        const bytes = new Uint8Array(binary.length);
        for (let i = 0; i < binary.length; i += 1) bytes[i] = binary.charCodeAt(i);
        return bytes;
      }

      async function toPngBytes(dataUrl) {
        try {
          const img = await loadImage(dataUrl);
          if (!img) return null;
          const canvas = document.createElement("canvas");
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);
          const pngUrl = canvas.toDataURL("image/png");
          return dataUrlToUint8(pngUrl);
        } catch (err) {
          console.warn("PNG conversion failed", err);
          return null;
        }
      }

      async function createMatrixPreview(tasksWithMeta, width = 520, height = 360) {
        const canvas = document.createElement("canvas");
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#fff";
        ctx.fillRect(0, 0, width, height);
        drawMatrixOnCanvas(ctx, { x: 12, y: 12, width: width - 24, height: height - 24 }, tasksWithMeta);
        return canvas.toDataURL("image/png");
      }

      function buildOpportunities(tasksWithMeta) {
        return [...tasksWithMeta].sort((a, b) => b.metrics.savings - a.metrics.savings).slice(0, 2);
      }

      function buildPriorityNote(task) {
        const priority = task.priority || "";
        if (priority === "Quick Win") return "Fast to deliver with low/no-code. Unlock savings quickly.";
        if (priority === "Strategic Bet") return "Higher effort, higher upside. Best planned as a scoped project.";
        if (priority === "Hobby") return "Good learning opportunity, lower business impact.";
        if (priority === "Trap") return "Complexity outweighs value. Do not automate first.";
        return "Reviewed against readiness and pain.";
      }

      function wrapLinesPdf(text, font, size, maxWidth) {
        const words = String(text || "").split(" ");
        const lines = [];
        let current = "";
        words.forEach((word) => {
          const test = current ? `${current} ${word}` : word;
          if (font.widthOfTextAtSize(test, size) > maxWidth && current) {
            lines.push(current);
            current = word;
          } else {
            current = test;
          }
        });
        if (current) lines.push(current);
        return lines;
      }

      function hexToRgb(hex) {
        const parsed = hex.replace("#", "");
        const bigint = parseInt(parsed, 16);
        const r = (bigint >> 16) & 255;
        const g = (bigint >> 8) & 255;
        const b = bigint & 255;
        return { r: r / 255, g: g / 255, b: b / 255 };
      }

      async function fetchFontBytes(urls) {
        const list = Array.isArray(urls) ? urls : [urls];
        for (const url of list) {
          try {
            const res = await fetch(url);
            if (!res.ok) throw new Error("font fetch failed");
            const buf = await res.arrayBuffer();
            return new Uint8Array(buf);
          } catch (err) {
            console.warn("Font fetch failed", err);
          }
        }
        return null;
      }

      function drawTextRight(page, text, xRight, y, size, font, color) {
        const width = font.widthOfTextAtSize(String(text), size);
        page.drawText(String(text), { x: xRight - width, y, size, font, color });
      }

      function addLinkAnnotation(doc, page, x, yTop, w, h, url) {
        if (!url) return;
        const { PDFName, PDFArray, PDFNumber, PDFString } = PDFLib;
        const ctx = doc.context;
        const yBottom = yTop - h;
        const rect = ctx.obj([x, yBottom, x + w, yTop]);
        const action = ctx.obj({
          Type: PDFName.of("Action"),
          S: PDFName.of("URI"),
          URI: PDFString.of(url),
        });
        const linkAnnot = ctx.obj({
          Type: PDFName.of("Annot"),
          Subtype: PDFName.of("Link"),
          Rect: rect,
          Border: ctx.obj([0, 0, 0]),
          A: action,
        });
        const annots = page.node.lookupMaybe(PDFName.of("Annots"), PDFArray) || ctx.obj([]);
        annots.push(linkAnnot);
        page.node.set(PDFName.of("Annots"), annots);
      }

      async function buildReportPdf(tasksWithMeta, totals, leadMeta) {
        const pdfLib = window.PDFLib;
        const { PDFDocument, rgb, PDFName, PDFArray, PDFNumber, PDFString } = pdfLib;
        const doc = await PDFDocument.create();
        const pageSize = { width: 595.28, height: 841.89 }; // A4 portrait
        const margin = 36;
        const grid = 8;
        const headerH = 56;
        const accentColor = hexToRgb("#F48847");
        const darkColor = hexToRgb("#134061");
        const lightBorder = rgb(0.88, 0.92, 0.96);
        const pageBg = rgb(0.97, 0.98, 0.99);

        // Use built-in fonts to avoid remote fetch failures
        const fontRegular = await doc.embedFont(pdfLib.StandardFonts.Helvetica);
        const fontBold = await doc.embedFont(pdfLib.StandardFonts.HelveticaBold);

        const logoBytes = await toPngBytes(LOGO_DATA);
        let logoImage = null;
        if (logoBytes) {
          try {
            logoImage = await doc.embedPng(logoBytes);
          } catch (err) {
            console.warn("Logo embed failed", err);
            logoImage = null;
          }
        }

        const addFooter = (page, pageNumber) => {
          page.drawLine({ start: { x: margin, y: 32 }, end: { x: pageSize.width - margin, y: 32 }, color: rgb(0.86, 0.9, 0.94), thickness: 0.6 });
          page.drawText("validagenda.com", { x: margin, y: 18, size: 10, font: fontRegular, color: rgb(0.42, 0.5, 0.6) });
          page.drawText(`Page ${pageNumber} of 2`, { x: pageSize.width - margin - 70, y: 18, size: 10, font: fontRegular, color: rgb(0.42, 0.5, 0.6) });
        };

        const drawSectionTitle = (page, y, title) => {
          page.drawRectangle({ x: margin, y: y - 4, width: 8, height: 20, color: rgb(accentColor.r, accentColor.g, accentColor.b) });
          page.drawText(title, { x: margin + 14, y, size: 15, font: fontBold, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          return y - 24;
        };

        const drawTile = (page, x, y, w, h, label, value, accentValue = false) => {
          page.drawRectangle({ x, y, width: w, height: h, color: rgb(1, 1, 1), borderColor: lightBorder, borderWidth: 1, radius: 10 });
          page.drawText(label, { x: x + 12, y: y + h - 18, size: 11, font: fontBold, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          page.drawText(value, { x: x + 12, y: y + h - 36, size: 14, font: fontBold, color: accentValue ? rgb(accentColor.r, accentColor.g, accentColor.b) : rgb(darkColor.r, darkColor.g, darkColor.b) });
        };

        const drawOpportunityCard = (page, x, y, w, h, task) => {
          page.drawRectangle({ x, y, width: w, height: h, color: rgb(1, 1, 1), borderColor: lightBorder, borderWidth: 1, radius: 10 });
          page.drawText(task.task || "Untitled task", { x: x + 10, y: y + h - 18, size: 13, font: fontBold, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          const priorityText = task.priority || "Priority";
          const pillW = fontBold.widthOfTextAtSize(priorityText, 10) + 12;
          page.drawRectangle({ x: x + w - pillW - 10, y: y + h - 26, width: pillW, height: 16, color: rgb(1, 1, 1), borderColor: rgb(accentColor.r, accentColor.g, accentColor.b), borderWidth: 1, radius: 8 });
          page.drawText(priorityText, { x: x + w - pillW - 6, y: y + h - 20, size: 10, font: fontBold, color: rgb(accentColor.r, accentColor.g, accentColor.b) });
          page.drawText(`Annual cost ${formatCurrency(task.metrics.annualCost)} · Savings ${formatCurrency(task.metrics.savings)}`, {
            x: x + 10,
            y: y + h - 36,
            size: 11,
            font: fontRegular,
            color: rgb(darkColor.r, darkColor.g, darkColor.b),
          });
          const noteLines = wrapLinesPdf(buildPriorityNote(task), fontRegular, 11, w - 20).slice(0, 2);
          noteLines.forEach((line, idx) => {
            page.drawText(line, { x: x + 10, y: y + h - 50 - idx * 13, size: 11, font: fontRegular, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          });
        };

        const drawCTA = async (page, y, height, isPrimary = true) => {
          page.drawRectangle({ x: margin, y: y - height, width: pageSize.width - margin * 2, height, color: rgb(darkColor.r, darkColor.g, darkColor.b), borderColor: lightBorder, borderWidth: 0, radius: 14 });
          page.drawText(isPrimary ? "Want a 15-minute walkthrough?" : "Book an Evaluate Session", {
            x: margin + 14,
            y: y - 20,
            size: isPrimary ? 14 : 13,
            font: fontBold,
            color: rgb(1, 1, 1),
          });
          if (isPrimary) {
            const bullets = [
              "Confirm your top Quick Win",
              "Map the simplest low-maintenance workflow",
              "Leave with a 30/60/90 plan and a costed estimate",
            ];
            bullets.forEach((b, idx) => {
              page.drawText("•", { x: margin + 14, y: y - 36 - idx * 14, size: 11, font: fontBold, color: rgb(0.92, 0.96, 1) });
              page.drawText(b, { x: margin + 22, y: y - 36 - idx * 14, size: 11, font: fontRegular, color: rgb(0.92, 0.96, 1) });
            });
            page.drawText("No jargon. No big-bang rebuild. Just measurable outcomes.", { x: margin + 14, y: y - 62 - bullets.length * 14, size: 10.5, font: fontRegular, color: rgb(0.9, 0.95, 1) });
          } else {
            page.drawText("Reply with your top task if you want a quick sanity check.", { x: margin + 14, y: y - 36, size: 11, font: fontRegular, color: rgb(0.92, 0.96, 1) });
            page.drawText(MEETING_URL, { x: margin + 14, y: y - 52, size: 11, font: fontBold, color: rgb(accentColor.r, accentColor.g, accentColor.b) });
            addLinkAnnotation(doc, page, margin + 12, y - 16, pageSize.width / 2, 20, MEETING_URL);
          }
          const buttonWidth = 190;
          const buttonHeight = 38;
          const buttonX = pageSize.width - margin - buttonWidth - 20;
          const buttonY = y - (isPrimary ? height - 22 : height - 22);
          page.drawRectangle({ x: buttonX, y: buttonY, width: buttonWidth, height: buttonHeight, color: rgb(accentColor.r, accentColor.g, accentColor.b), radius: 10 });
          page.drawText("Book an Evaluate Session", { x: buttonX + 12, y: buttonY + 12, size: 12, font: fontBold, color: rgb(1, 1, 1) });
          addLinkAnnotation(doc, page, buttonX, buttonY + buttonHeight, buttonWidth, buttonHeight, MEETING_URL);

          const qr = await loadQrImage(MEETING_URL);
          if (qr) {
            const c = document.createElement("canvas");
            c.width = 110;
            c.height = 110;
            c.getContext("2d").drawImage(qr, 0, 0, 110, 110);
            const qrBytes = dataUrlToUint8(c.toDataURL("image/png"));
            if (qrBytes) {
              try {
                const qrImg = await doc.embedPng(qrBytes);
                page.drawImage(qrImg, { x: buttonX + buttonWidth - 60, y: buttonY - 60, width: 50, height: 50 });
                addLinkAnnotation(doc, page, buttonX + buttonWidth - 60, buttonY - 10, 50, 50, MEETING_URL);
              } catch (err) {
                console.warn("QR embed failed", err);
              }
            }
          }
        };

        const drawMatrix = (page, x, y, w, h, tasks) => {
          const pad = 14;
          page.drawRectangle({ x, y: y - h, width: w, height: h, color: rgb(1, 1, 1), borderColor: lightBorder, borderWidth: 1, radius: 10 });
          const quadW = w / 2;
          const quadH = h / 2;
          page.drawRectangle({ x: x, y: y - quadH, width: quadW, height: quadH, color: rgb(1, 0.92, 0.92) }); // Trap
          page.drawRectangle({ x: x + quadW, y: y - quadH, width: quadW, height: quadH, color: rgb(0.9, 0.95, 1) }); // Strategic Bet
          page.drawRectangle({ x: x, y: y - h, width: quadW, height: quadH, color: rgb(0.93, 0.95, 0.97) }); // Hobby
          page.drawRectangle({ x: x + quadW, y: y - h, width: quadW, height: quadH, color: rgb(1, 0.95, 0.92) }); // Quick Win
          page.drawLine({ start: { x: x + quadW, y: y }, end: { x: x + quadW, y: y - h }, color: lightBorder, thickness: 1 });
          page.drawLine({ start: { x: x, y: y - quadH }, end: { x: x + w, y: y - quadH }, color: lightBorder, thickness: 1 });
          page.drawText("Trap", { x: x + pad, y: y - quadH + quadH / 2, size: 11, font: fontBold, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          page.drawText("Strategic Bet", { x: x + quadW + pad, y: y - quadH + quadH / 2, size: 11, font: fontBold, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          page.drawText("Hobby", { x: x + pad, y: y - h + quadH / 2, size: 11, font: fontBold, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          page.drawText("Quick Win", { x: x + quadW + pad, y: y - h + quadH / 2, size: 11, font: fontBold, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          page.drawText("Effort up", { x: x + 4, y: y - 12, size: 10, font: fontRegular, color: rgb(0.4, 0.48, 0.56) });
          page.drawText("Impact right", { x: x + w - 80, y: y - h + 6, size: 10, font: fontRegular, color: rgb(0.4, 0.48, 0.56) });

          const maxImpact = Math.max(...tasks.map((t) => t.metrics.annualCost), 1);
          const innerW = w - pad * 2;
          const innerH = h - pad * 2;

          const mapEffort = (eff) => {
            const level = (eff || "").toLowerCase();
            if (level === "low") return 0.2;
            if (level === "medium") return 0.5;
            return 0.8;
          };

          tasks.slice(0, 6).forEach((t) => {
            const impactRatio = Math.min(1, Math.max(0, t.metrics.annualCost / maxImpact));
            const effortRatio = mapEffort(t.readinessEffort);
            const px = x + pad + impactRatio * innerW;
            const py = y - pad - (1 - effortRatio) * innerH;
            page.drawCircle({ x: px, y: py, size: 5, color: rgb(accentColor.r, accentColor.g, accentColor.b), borderColor: rgb(1, 1, 1), borderWidth: 1.5 });
          });
        };

        const capacityWeekly = totals.weeklyHours * 0.5;
        const capacityAnnual = totals.annualHours * 0.5;
        const leadName = [leadMeta.firstName, leadMeta.lastName, leadMeta.email].find((v) => v) || "your team";
        const role = leadMeta.role ? ` · ${leadMeta.role}` : "";
        const dateStr = new Date().toLocaleDateString();
        const topTasks = buildOpportunities(tasksWithMeta);

        // Page 1
        {
          const page = doc.addPage([pageSize.width, pageSize.height]);
          page.drawRectangle({ x: 0, y: 0, width: pageSize.width, height: pageSize.height, color: pageBg });

          // Header
          page.drawRectangle({ x: margin, y: pageSize.height - margin - headerH, width: pageSize.width - margin * 2, height: headerH, color: rgb(darkColor.r, darkColor.g, darkColor.b), borderRadius: 12 });
          if (logoImage) {
            const logoW = 120;
            const logoH = (logoW / logoImage.width) * logoImage.height;
            page.drawImage(logoImage, { x: margin + 12, y: pageSize.height - margin - headerH + 10, width: logoW, height: logoH });
          }
          page.drawText("Automation ROI Report", { x: pageSize.width - margin - 200, y: pageSize.height - margin - headerH + 32, size: 16, font: fontBold, color: rgb(1, 1, 1) });
          page.drawText(`Date: ${dateStr}`, { x: pageSize.width - margin - 200, y: pageSize.height - margin - headerH + 16, size: 11, font: fontRegular, color: rgb(0.9, 0.95, 1) });

          let y = pageSize.height - margin - headerH - grid;
          page.drawText(`Prepared for ${leadName}${role}`, { x: margin, y: y, size: 12, font: fontRegular, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          page.drawText("validagenda.com", { x: pageSize.width - margin - 100, y: y, size: 12, font: fontBold, color: rgb(accentColor.r, accentColor.g, accentColor.b) });
          y -= grid * 2;

          // Hero card
          const heroH = 72;
          page.drawRectangle({ x: margin, y: y - heroH, width: pageSize.width - margin * 2, height: heroH, color: rgb(1, 1, 1), borderColor: lightBorder, borderWidth: 1, radius: 12 });
          page.drawText("Your biggest time and cost leaks - quantified", { x: margin + 12, y: y - 20, size: 16, font: fontBold, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          const heroLines = wrapLinesPdf(
            "This report summarises the recurring work you captured and what 50% automation could return in time and dollars.",
            fontRegular,
            12,
            pageSize.width - margin * 2 - 24
          );
          heroLines.forEach((line, idx) => page.drawText(line, { x: margin + 12, y: y - 36 - idx * 14, size: 12, font: fontRegular, color: rgb(0.35, 0.42, 0.5) }));
          y -= heroH + grid * 2;

          // Metrics 2x2
          const cardW = (pageSize.width - margin * 2 - grid * 2) / 2;
          const cardH = 62;
          drawTile(page, margin, y - cardH, cardW, cardH, "Current annual cost", formatCurrency(totals.annualCost), true);
          drawTile(page, margin + cardW + grid * 2, y - cardH, cardW, cardH, "Potential savings (50%)", formatCurrency(totals.savings), true);
          drawTile(page, margin, y - cardH * 2 - grid, cardW, cardH, "Weekly hours captured", `${totals.weeklyHours.toFixed(1)} hrs`);
          drawTile(page, margin + cardW + grid * 2, y - cardH * 2 - grid, cardW, cardH, "Capacity returned (weekly)", `${capacityWeekly.toFixed(1)} hrs`);
          y -= cardH * 2 + grid * 3;

          // Opportunities
          y = drawSectionTitle(page, y, "Top opportunities");
          const oppW = (pageSize.width - margin * 2 - grid * 2) / 2;
          const oppH = 96;
          topTasks.forEach((t, idx) => {
            const ox = margin + idx * (oppW + grid * 2);
            drawOpportunityCard(page, ox, y - oppH, oppW, oppH, t);
          });
          y -= oppH + grid * 2;
          page.drawText("Quick Wins are typically the fastest to implement with low/no-code tools.", { x: margin, y, size: 10.5, font: fontRegular, color: rgb(0.45, 0.52, 0.62) });
          y -= grid * 3;

          // CTA
          await drawCTA(page, y, 120, true);

          addFooter(page, 1);
        }

        // Page 2
        {
          const page = doc.addPage([pageSize.width, pageSize.height]);
          page.drawRectangle({ x: 0, y: 0, width: pageSize.width, height: pageSize.height, color: pageBg });
          let y = pageSize.height - margin;

          y = drawSectionTitle(page, y, "What you captured");
          const tableW = pageSize.width - margin * 2;
          const tableH = 8 * 18 + 32;
          page.drawRectangle({ x: margin, y: y - tableH, width: tableW, height: tableH, color: rgb(1, 1, 1), borderColor: lightBorder, borderWidth: 1, radius: 12 });
          const columns = [
            { label: "Task", x: margin + 12, align: "left" },
            { label: "Role", x: margin + 170, align: "left" },
            { label: "Weekly hours", x: margin + 320, align: "right" },
            { label: "Annual cost", x: margin + 430, align: "right" },
            { label: "Savings (50%)", x: margin + 520, align: "right" },
            { label: "Priority", x: margin + 560, align: "right" },
          ];
          columns.forEach((col) => page.drawText(col.label, { x: col.x, y: y - 16, size: 10, font: fontBold, color: rgb(darkColor.r, darkColor.g, darkColor.b) }));

          const rowHeight = 18;
          const rows = tasksWithMeta.slice(0, 8);
          rows.forEach((t, idx) => {
            const rowY = y - 32 - idx * rowHeight;
            if (idx % 2 === 0) page.drawRectangle({ x: margin, y: rowY - rowHeight + 4, width: tableW, height: rowHeight, color: rgb(0.985, 0.99, 0.995) });
            page.drawText(t.task || "Untitled", { x: columns[0].x, y: rowY, size: 10, font: fontRegular, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
            page.drawText(t.role || "Owner", { x: columns[1].x, y: rowY, size: 10, font: fontRegular, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
            drawTextRight(page, t.metrics.weeklyHours.toFixed(1), columns[2].x, rowY, 10, fontRegular, rgb(darkColor.r, darkColor.g, darkColor.b));
            drawTextRight(page, formatCurrency(t.metrics.annualCost), columns[3].x, rowY, 10, fontRegular, rgb(darkColor.r, darkColor.g, darkColor.b));
            drawTextRight(page, formatCurrency(t.metrics.savings), columns[4].x, rowY, 10, fontRegular, rgb(accentColor.r, accentColor.g, accentColor.b));
            drawTextRight(page, t.priority || "", columns[5].x, rowY, 10, fontBold, rgb(darkColor.r, darkColor.g, darkColor.b));
          });
          if (tasksWithMeta.length > rows.length) {
            page.drawText(`+${tasksWithMeta.length - rows.length} more tasks not shown`, { x: margin + 10, y: y - 32 - rows.length * rowHeight - 10, size: 10, font: fontRegular, color: rgb(0.45, 0.52, 0.62) });
          }
          y = y - tableH - grid * 2;

          // Matrix
          y = drawSectionTitle(page, y, "Portfolio view");
          drawMatrix(page, margin, y - 260, tableW, 260, tasksWithMeta);
          y = y - 260 - grid * 2;
          page.drawText("Impact uses annual cost. Effort uses readiness toggles.", { x: margin, y, size: 10, font: fontRegular, color: rgb(0.45, 0.52, 0.62) });
          y -= grid * 3;

          // If you do nothing
          y = drawSectionTitle(page, y, "If you do nothing");
          const calloutH = 54;
          page.drawRectangle({ x: margin, y: y - calloutH, width: tableW, height: calloutH, color: rgb(1, 1, 1), borderColor: lightBorder, borderWidth: 1, radius: 10 });
          page.drawText(`You are currently spending ~${formatCurrency(totals.annualCost)} per year on these tasks.`, { x: margin + 12, y: y - 20, size: 11, font: fontRegular, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          page.drawText(`At 50% automation, you could reclaim ~${capacityAnnual.toFixed(1)} hours per year.`, { x: margin + 12, y: y - 36, size: 11, font: fontRegular, color: rgb(darkColor.r, darkColor.g, darkColor.b) });
          y -= calloutH + grid * 3;

          // CTA repeat
          await drawCTA(page, y, 94, false);

          addFooter(page, 2);
        }

        const pdfBytes = await doc.save();
        return new Blob([pdfBytes], { type: "application/pdf" });
      }

      function downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        link.remove();
        setTimeout(() => URL.revokeObjectURL(url), 500);
      }

      function blobToBase64(blob) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onloadend = () => {
            const res = reader.result || "";
            const [, data = ""] = String(res).split(",");
            resolve(data);
          };
          reader.onerror = (err) => reject(err);
          reader.readAsDataURL(blob);
        });
      }

      function setPainValue(val, silent = false) {
        els.painInput.value = val;
        els.painChips.forEach((chip) => {
          const isActive = Number(chip.dataset.pain) === Number(val);
          chip.classList.toggle("active", isActive);
          if (isActive && chip.dataset.label) {
            els.painDisplay.textContent = chip.dataset.label;
          }
        });
        if (!silent) update();
      }

      function renderTaskReadinessForm() {
        els.taskReadinessList.innerHTML = "";
        readinessChecks.forEach((check) => {
          const item = document.createElement("div");
          item.className = "va-ready-item";

          const labelRow = document.createElement("div");
          labelRow.className = "va-ready-label";
          const label = document.createElement("span");
          label.textContent = check.label;
          const info = document.createElement("span");
          info.className = "va-info";
          info.textContent = "";
          info.title = "";
          info.setAttribute("data-tip", "");
          info.style.display = "none";
          labelRow.appendChild(label);
          labelRow.appendChild(info);

          const switchBtn = document.createElement("button");
          switchBtn.type = "button";
          switchBtn.className = "va-switch";
          const thumb = document.createElement("span");
          thumb.className = "va-switch-thumb";
          switchBtn.appendChild(thumb);

          const applyState = (val) => {
            switchBtn.classList.toggle("on", val === true);
          };

          const setState = (val) => {
            state.formReadiness[check.id] = val;
            applyState(val);
            saveState();
            update();
          };

          switchBtn.addEventListener("click", () => setState(!state.formReadiness[check.id]));

          const saved = state.formReadiness[check.id];
          applyState(saved === true);
          if (saved !== true) state.formReadiness[check.id] = false;

          item.appendChild(labelRow);
          item.appendChild(switchBtn);
          els.taskReadinessList.appendChild(item);
        });
      }

      function validateNumbers() {
        const { freq, minutes, hourly } = els.fields;
        const values = [freq, minutes, hourly];
        const invalid = values.some((input) => Number(input.value) < 0);
        if (invalid) {
          els.formError.style.display = "block";
          els.formError.textContent = "Inputs cannot be negative.";
          return false;
        }
        els.formError.style.display = "none";
        return true;
      }

      function validateForSave() {
        const baseValid = validateNumbers();
        const missingName = getFormTask().task === "";
        if (!baseValid || missingName) {
          els.formError.style.display = "block";
          els.formError.textContent = missingName ? "Give the task a name before saving." : els.formError.textContent;
          return false;
        }
        return true;
      }

      function getReadinessScore(readiness = {}) {
        const total = readinessChecks.length;
        const yesCount = readinessChecks.reduce((acc, check) => acc + (readiness[check.id] ? 1 : 0), 0);
        const score = total ? yesCount / total : 0;
        const effort = score >= 0.6 ? "Low" : score >= 0.4 ? "Medium" : "High";
        return { score, effort };
      }

      function calculateTaskMetrics(task) {
        const weeklyHours = (task.freq * task.minutes) / 60;
        const annualHours = weeklyHours * 52;
        const annualCost = annualHours * task.hourly;
        const savings = annualCost * 0.5;
        return { weeklyHours, annualHours, annualCost, savings };
      }

      function calculateTotals(tasks) {
        return tasks.reduce(
          (acc, task) => {
            const m = calculateTaskMetrics(task);
            acc.weeklyHours += m.weeklyHours;
            acc.annualHours += m.annualHours;
            acc.annualCost += m.annualCost;
            acc.savings += m.savings;
            return acc;
          },
          { weeklyHours: 0, annualHours: 0, annualCost: 0, savings: 0 }
        );
      }

      function getDecisionMeta(impactValue, effortScore) {
        const impactLevel = impactValue >= 20000 ? "High" : "Low";
        const effortLevel = effortScore >= 0.6 ? "Low" : effortScore >= 0.4 ? "Medium" : "High";

        let badgeClass = "hobby";
        let label = "Low Impact + Low Effort";
        let note = "Focus where the value is meaningful and the path to automate is clear.";

        if (impactLevel === "High" && effortLevel === "Low") {
          badgeClass = "quick";
          label = "Quick Win";
          note = "High dollar impact with a clear path — act fast.";
        } else if (impactLevel === "High" && effortLevel !== "Low") {
          badgeClass = "bet";
          label = "Strategic Bet";
          note = "Big upside, but plan for change management or tech dependencies.";
        } else if (impactLevel === "Low" && effortLevel === "Low") {
          badgeClass = "hobby";
          label = "Hobby";
          note = "Light lift, low value. Only automate if it unlocks learning or morale.";
        } else {
          badgeClass = "trap";
          label = "Trap";
          note = "Low value and high effort. Park it or simplify before automating.";
        }

        return { badgeClass, label, note, impactLevel, effortLevel };
      }

      function saveState() {
        try {
          const payload = {
            values: {
              task: els.fields.task.value,
              freq: els.fields.freq.value,
              minutes: els.fields.minutes.value,
              hourly: els.fields.hourly.value,
              role: els.fields.role.value,
              pain: els.painInput.value,
            },
            tasks: state.tasks,
            editingId: state.editingId,
            formReadiness: state.formReadiness,
          };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        } catch (err) {
          // fail silently; storage may be blocked
        }
      }

      function restoreState() {
        try {
          const saved = localStorage.getItem(STORAGE_KEY);
          if (!saved) return;
          const parsed = JSON.parse(saved);
          if (parsed.values) {
            const { task, freq, minutes, hourly, role, pain } = parsed.values;
            els.fields.task.value = task || "";
            els.fields.freq.value = freq || "";
            els.fields.minutes.value = minutes || "";
            els.fields.hourly.value = hourly || "";
            els.fields.role.value = role || "";
            els.painInput.value = pain || 5;
            els.painDisplay.textContent = els.painInput.value;
          }
          if (parsed.readiness) {
            state.formReadiness = parsed.readiness;
          }
          if (Array.isArray(parsed.tasks)) {
            state.tasks = parsed.tasks;
          }
          state.editingId = parsed.editingId || null;
          if (parsed.formReadiness) {
            state.formReadiness = parsed.formReadiness;
          }
        } catch (err) {
          console.warn("Could not restore saved state", err);
        }
      }

      function resetForm() {
        els.fields.task.value = "";
        els.fields.freq.value = "";
        els.fields.minutes.value = "";
        els.fields.hourly.value = "";
        els.fields.role.value = "";
        setPainValue(5, true);
        state.formReadiness = {};
        state.editingId = null;
        renderTaskReadinessForm();
        setSaveMode();
      }

      function setSaveMode() {
        els.saveTaskBtn.textContent = state.editingId ? "Update task" : "Save task";
      }

      function loadTaskIntoForm(task) {
        els.fields.task.value = task.task || "";
        els.fields.freq.value = task.freq || "";
        els.fields.minutes.value = task.minutes || "";
        els.fields.hourly.value = task.hourly || "";
        els.fields.role.value = task.role || "";
        setPainValue(task.pain || 5, true);
        state.formReadiness = task.readiness || {};
        renderTaskReadinessForm();
        state.editingId = task.id;
        setSaveMode();
      }

      function renderTaskList() {
        els.taskList.innerHTML = "";
        if (!state.tasks.length) {
          els.taskEmpty.style.display = "block";
          return;
        }
        els.taskEmpty.style.display = "none";
        state.tasks.forEach((task) => {
          const metrics = calculateTaskMetrics(task);
          const row = document.createElement("div");
          row.style.display = "flex";
          row.style.alignItems = "center";
          row.style.justifyContent = "space-between";
          row.style.gap = "10px";
          row.style.border = `1px solid ${getComputedStyle(document.documentElement).getPropertyValue("--va-line") || "#d9e1ea"}`;
          row.style.borderRadius = "14px";
          row.style.padding = "12px 14px";
          row.style.background = "var(--va-panel)";
          row.style.boxShadow = "0 10px 28px rgba(19,64,97,0.12)";

          const left = document.createElement("div");
          left.innerHTML = `<strong style="font-size:1.05rem;">${task.task}</strong><div style="color:var(--va-muted);font-size:0.9rem;margin-top:2px;">${task.role || "Owner"}</div><div style="color:var(--va-accent);font-weight:700;margin-top:6px;">${metrics.weeklyHours.toFixed(1)} hrs/wk · ${formatCurrency(metrics.annualCost)}/yr · ${formatCurrency(metrics.savings)} est. savings</div>`;

          const actions = document.createElement("div");
          actions.style.display = "flex";
          actions.style.alignItems = "center";
          actions.style.gap = "8px";

          const editBtn = document.createElement("button");
          editBtn.textContent = "Edit";
          editBtn.className = "va-btn";
          editBtn.addEventListener("click", () => {
            loadTaskIntoForm(task);
          });

          const viewBtn = document.createElement("button");
          viewBtn.textContent = "View";
          viewBtn.className = "va-btn";
          viewBtn.addEventListener("click", () => {
            update();
            location.hash = "#part-3";
          });

          const removeBtn = document.createElement("button");
          removeBtn.textContent = "Remove";
          removeBtn.className = "va-btn";
          removeBtn.addEventListener("click", () => {
            state.tasks = state.tasks.filter((t) => t.id !== task.id);
            renderTaskList();
            update();
          });

          actions.appendChild(viewBtn);
          actions.appendChild(removeBtn);
          actions.appendChild(editBtn);
          row.appendChild(left);
          row.appendChild(actions);
          els.taskList.appendChild(row);
        });
      }

      function getPortfolioTasks() {
        if (state.tasks.length) return state.tasks;
        const fallback = getFormTask();
        return fallback.task || fallback.freq || fallback.minutes || fallback.hourly ? [fallback] : [];
      }

      function renderROI(tasks) {
        const totals = calculateTotals(tasks);

        els.weeklyHours.textContent = `${totals.weeklyHours.toFixed(1)} hrs / week`;
        els.annualHours.textContent = totals.annualHours.toFixed(1);
        els.annualCost.textContent = `${formatCurrency(totals.annualCost)} / year`;
        els.savingsFigure.textContent = formatCurrency(totals.savings);

        const maxCost = Math.max(totals.annualCost, totals.savings, 1);
        els.costBar.style.width = `${percentOf(maxCost, totals.annualCost)}%`;
        els.savingsBar.style.width = `${percentOf(maxCost, totals.savings)}%`;

        return totals;
      }

      function renderTaskTable(tasks, totals) {
        els.taskTableBody.innerHTML = "";
        const hasTasks = tasks.length > 0;
        els.taskTableEmpty.style.display = hasTasks ? "none" : "block";
        if (!hasTasks) {
          els.totalWeekly.textContent = "0";
          els.totalAnnual.textContent = "0";
          els.totalCost.textContent = "$0";
          els.totalSavings.textContent = "$0";
          return;
        }

        tasks.forEach((task) => {
          const metrics = calculateTaskMetrics(task);
          const row = document.createElement("div");
          row.className = "va-table-row";
          row.innerHTML = `
            <span><strong>${task.task || "Untitled task"}</strong><small>${task.freq || 0}x/wk · ${task.minutes || 0} min each</small></span>
            <span>${task.role || "Owner"}</span>
            <span style="font-weight:700;color:var(--va-accent);">${metrics.weeklyHours.toFixed(1)}</span>
            <span>${metrics.annualHours.toFixed(1)}</span>
            <span style="font-weight:700;color:var(--va-accent);">${formatCurrency(metrics.annualCost)}</span>
            <span>${formatCurrency(metrics.savings)}</span>
          `;
          els.taskTableBody.appendChild(row);
        });

        els.totalWeekly.textContent = totals.weeklyHours.toFixed(1);
        els.totalAnnual.textContent = totals.annualHours.toFixed(1);
        els.totalCost.textContent = formatCurrency(totals.annualCost);
        els.totalSavings.textContent = formatCurrency(totals.savings);
      }

      function renderMatrix(tasks) {
        const canvas = els.matrixCanvas;
        if (!canvas) return;
        const ctx = canvas.getContext("2d");
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        let tooltip = els.matrixPlot.querySelector(".va-tooltip");
        if (!tooltip) {
          tooltip = document.createElement("div");
          tooltip.className = "va-tooltip";
          tooltip.style.position = "absolute";
          tooltip.style.padding = "10px 12px";
          tooltip.style.borderRadius = "10px";
          tooltip.style.background = getComputedStyle(document.documentElement).getPropertyValue("--va-primary") || "#134061";
          tooltip.style.color = "#fff";
          tooltip.style.fontSize = "0.9rem";
          tooltip.style.boxShadow = "0 12px 30px rgba(19,64,97,0.25)";
          tooltip.style.pointerEvents = "none";
          tooltip.style.display = "none";
          tooltip.style.zIndex = "5";
          tooltip.style.minWidth = "240px";
          tooltip.style.maxWidth = "320px";
          els.matrixPlot.appendChild(tooltip);
        }

        if (!tasks.length) {
          tooltip.style.display = "none";
          return;
        }

        const w = canvas.width;
        const h = canvas.height;
        const padding = 24;

        // Quadrants
        ctx.fillStyle = "rgba(201,75,75,0.12)";
        ctx.fillRect(0, 0, w / 2, h / 2);
        ctx.fillStyle = "rgba(19,64,97,0.12)";
        ctx.fillRect(w / 2, 0, w / 2, h / 2);
        ctx.fillStyle = "rgba(15,31,51,0.08)";
        ctx.fillRect(0, h / 2, w / 2, h / 2);
        ctx.fillStyle = "rgba(244,136,71,0.16)";
        ctx.fillRect(w / 2, h / 2, w / 2, h / 2);

        ctx.fillStyle = "rgba(19,64,97,0.45)";
        ctx.font = "700 14px " + (getComputedStyle(document.documentElement).getPropertyValue("--va-font") || "Inter, sans-serif");
        ctx.fillText("Strategic Bet", w * 0.65, h * 0.25);
        ctx.fillText("Trap", w * 0.15, h * 0.25);
        ctx.fillText("Hobby", w * 0.15, h * 0.75);
        ctx.fillText("Quick Win", w * 0.65, h * 0.75);

        // Use a fixed floor so single low-value tasks don't always pin to the far right.
        const IMPACT_FLOOR = 20000;
        const maxImpact = Math.max(...tasks.map((t) => calculateTaskMetrics(t).annualCost), IMPACT_FLOOR);
        matrixDots = [];

        tasks.forEach((task) => {
          const metrics = calculateTaskMetrics(task);
          const impactRatio = Math.min(1, Math.max(0, metrics.annualCost / maxImpact));
          const { score } = getReadinessScore(task.readiness || {});
          const effortRatio = Math.min(1, Math.max(0, (1 - score) + (10 - task.pain) / 25));
          const { badgeClass, label, note } = getDecisionMeta(metrics.annualCost, score);

          const x = padding + impactRatio * (w - padding * 2);
          const y = padding + (1 - effortRatio) * (h - padding * 2);

          ctx.beginPath();
          ctx.arc(x, y, 8, 0, Math.PI * 2);
          ctx.fillStyle =
            badgeClass === "quick"
              ? "#f48847"
              : badgeClass === "bet"
              ? "#134061"
              : badgeClass === "hobby"
              ? "rgba(82,104,128,0.9)"
              : "#c94b4b";
          ctx.fill();
          ctx.strokeStyle = "#fff";
          ctx.lineWidth = 2;
          ctx.stroke();

          matrixDots.push({
            x,
            y,
            r: 10,
            task: task.task,
            label,
            note,
            metrics,
          });
        });

        const handleHover = (evt) => {
          const rect = canvas.getBoundingClientRect();
          const x = evt.clientX - rect.left;
          const y = evt.clientY - rect.top;
          let hit = null;
          for (const dot of matrixDots) {
            const dx = x - dot.x;
            const dy = y - dot.y;
            if (Math.sqrt(dx * dx + dy * dy) <= dot.r + 2) {
              hit = dot;
              break;
            }
          }
          if (hit) {
            tooltip.style.display = "block";
            tooltip.innerHTML = `<strong>${hit.task}</strong><div style="font-size:0.85rem;margin-top:4px;">${hit.label}</div><div style="font-size:0.85rem;color:rgba(255,255,255,0.85);">Annual: ${formatCurrency(hit.metrics.annualCost)} · Weekly: ${hit.metrics.weeklyHours.toFixed(1)} hrs · Savings 50%: ${formatCurrency(hit.metrics.savings)}</div><div style="font-size:0.8rem;color:rgba(255,255,255,0.7);margin-top:4px;">${hit.note}</div>`;

            // Flip tooltip to the left when hovering near the right edge to avoid clipping
            const offset = 12;
            const tooltipWidth = tooltip.offsetWidth || 260;
            const tooltipHeight = tooltip.offsetHeight || 120;
            let left = hit.x + offset;
            const maxLeft = canvas.width - tooltipWidth - offset;
            if (left > maxLeft) {
              left = hit.x - tooltipWidth - offset;
            }
            left = Math.max(8, Math.min(left, maxLeft));

            let top = hit.y - tooltipHeight / 2;
            top = Math.max(8, Math.min(top, canvas.height - tooltipHeight - 8));

            tooltip.style.left = `${left}px`;
            tooltip.style.top = `${top}px`;
          } else {
            tooltip.style.display = "none";
          }
        };

        if (!canvas._hoverBound) {
          canvas.addEventListener("mousemove", handleHover);
          canvas.addEventListener("mouseleave", () => {
            const tooltip = els.matrixPlot.querySelector(".va-tooltip");
            if (tooltip) tooltip.style.display = "none";
          });
          canvas._hoverBound = true;
        }
      }

      function renderClassificationTable(tasks) {
        els.classificationTable.innerHTML = "";
        const hasTasks = tasks.length > 0;
        els.classificationEmpty.style.display = hasTasks ? "none" : "block";
        if (!hasTasks) return;

        tasks.forEach((task) => {
          const metrics = calculateTaskMetrics(task);
          const { score } = getReadinessScore(task.readiness || {});
          const { label, impactLevel, effortLevel, badgeClass } = getDecisionMeta(metrics.annualCost, score);
          const row = document.createElement("div");
          row.className = "va-table-row";
          row.innerHTML = `
            <span><strong>${task.task || "Untitled task"}</strong><small>${task.freq || 0}x/wk · ${task.minutes || 0} min</small></span>
            <span>${task.role || "Owner"}</span>
            <span>${impactLevel}</span>
            <span>${effortLevel}</span>
            <span style="font-weight:700;color:var(--va-danger);">${formatCurrency(metrics.annualCost)}</span>
            <span style="font-weight:700;color:var(--va-success);">${formatCurrency(metrics.savings)}</span>
            <span><span class="priority-pill ${badgeClass}">${label}</span></span>
          `;
          els.classificationTable.appendChild(row);
        });
      }

      async function postWebhook(payload, pdfBase64) {
        const fullPayload = pdfBase64
          ? {
              ...payload,
              pdf: {
                filename: "Valid-Agenda-Automation-ROI-Report.pdf",
                mimeType: "application/pdf",
                base64: pdfBase64,
              },
            }
          : payload;

        const sendBeacon = () => {
          if (!navigator.sendBeacon) return false;
          try {
            // sendBeacon has a ~64kb limit; omit PDF to ensure delivery.
            const compact = { ...payload, pdf: undefined };
            const blob = new Blob([JSON.stringify(compact)], { type: "application/json" });
            return navigator.sendBeacon(WEBHOOK_URL, blob);
          } catch (err) {
            console.warn("sendBeacon failed", err);
            return false;
          }
        };

        try {
          const res = await fetch(WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(fullPayload),
          });
          return res;
        } catch (err) {
          console.warn("Webhook fetch failed, falling back to no-cors", err);
          // Fallback for CORS-restricted environments; if this fails, try sendBeacon without PDF.
          try {
            await fetch(WEBHOOK_URL, {
              method: "POST",
              mode: "no-cors",
              headers: { "Content-Type": "text/plain;charset=UTF-8" },
              body: JSON.stringify(fullPayload),
            });
            return { ok: true, opaque: true };
          } catch (fallbackErr) {
            console.warn("no-cors fallback failed, trying sendBeacon", fallbackErr);
            const beaconSent = sendBeacon();
            if (beaconSent) return { ok: true, beacon: true };
            throw fallbackErr;
          }
        }
      }

      async function submitLeadMagnet(evt) {
        evt.preventDefault();
        if (!els.leadForm) return;

        const firstName = (els.leadFirstName?.value || "").trim();
        const lastName = (els.leadLastName?.value || "").trim();
        const leadRole = els.leadRole?.value || "";
        const email = els.leadEmail.value.trim();
        const consent = els.leadConsent.checked;

        if (!firstName || !lastName || !leadRole) {
          setLeadStatus("Add your name and role to continue.", "error");
          return;
        }
        if (!validateEmail(email)) {
          setLeadStatus("Enter a valid email to continue.", "error");
          return;
        }
        if (!consent) {
          setLeadStatus("Please confirm you agree to communications.", "error");
          return;
        }

        setLeadStatus("Sending to Valid Agenda...", "");
        if (els.leadSubmit) {
          els.leadSubmit.disabled = true;
          els.leadSubmit.textContent = "Working...";
        }

        const tasks = getPortfolioTasks();
        const totals = calculateTotals(tasks);

        const tasksWithMeta = tasks.map((task) => {
          const metrics = calculateTaskMetrics(task);
          const readiness = getReadinessScore(task.readiness || {});
          const decision = getDecisionMeta(metrics.annualCost, readiness.score);
          return {
            task: task.task,
            role: task.role,
            freq: task.freq,
            minutes: task.minutes,
            hourly: task.hourly,
            pain: task.pain,
            readiness: task.readiness,
            readinessScore: readiness.score,
            readinessEffort: readiness.effort,
            metrics,
            priority: decision.label,
            priorityClass: decision.badgeClass,
          };
        });

        const payload = {
          firstName,
          lastName,
          role: leadRole,
          email,
          consent,
          submittedAt: new Date().toISOString(),
          source: "Automation ROI Calculator",
          hasSavedTasks: !!state.tasks.length,
          totals,
          tasks: tasksWithMeta,
          location: window.location.href,
        };

        let downloadOk = true;
        let pdfBase64 = null;
        // Generate + download PDF while preparing webhook payload
        try {
          const pdfBlob = await buildReportPdf(tasksWithMeta, totals, {
            firstName,
            lastName,
            role: leadRole,
            email,
            location: window.location.href,
          });
          pdfBase64 = await blobToBase64(pdfBlob);
          downloadBlob(pdfBlob, "Valid-Agenda-Automation-ROI-Report.pdf");
        } catch (err) {
          console.error("PDF build/download failed", err);
          setLeadStatus("Download failed. Please retry.", "error");
          downloadOk = false;
        }

        try {
          const res = await postWebhook(payload, pdfBase64);
          if (res && res.ok) {
            if (downloadOk) {
              setLeadStatus("Thanks! Your PDF is downloading and we’ll follow up shortly.", "success");
            }
          } else {
            setLeadStatus(downloadOk ? "PDF is downloading. Follow-up may not be recorded—please try again later." : "Follow-up may not be recorded—please try again later.", "error");
          }
        } catch (err) {
          console.error("Lead capture failed", err);
          setLeadStatus(downloadOk ? "PDF is downloading. We couldn't reach the server—please try again." : "We couldn't reach the server—please try again.", "error");
        } finally {
          if (els.leadSubmit) {
            els.leadSubmit.disabled = false;
            els.leadSubmit.textContent = "Download PDF";
          }
        }
      }

      function update() {
        if (!validateNumbers()) return;
        const tasks = getPortfolioTasks();
        const totals = renderROI(tasks);
        renderTaskTable(tasks, totals);
        renderMatrix(tasks);
        renderClassificationTable(tasks);
        saveState();
      }

      function attachEvents() {
        Object.values(els.fields).forEach((input) => {
          input.addEventListener("input", update);
        });
        els.painChips.forEach((chip) => {
          chip.addEventListener("click", () => {
            setPainValue(Number(chip.dataset.pain));
          });
        });

        els.saveTaskBtn.addEventListener("click", () => {
          if (!validateForSave()) return;
          const task = { ...getFormTask(), id: state.editingId || (crypto.randomUUID ? crypto.randomUUID() : String(Date.now() + Math.random())) };
          if (state.editingId) {
            state.tasks = state.tasks.map((t) => (t.id === state.editingId ? task : t));
          } else {
            state.tasks.push(task);
          }
          renderTaskList();
          resetForm();
          update();
        });

        window.addEventListener("resize", () => {
          renderMatrix(getPortfolioTasks());
        });

        if (els.leadForm) {
          els.leadForm.addEventListener("submit", submitLeadMagnet);
        }
      }

      // Initialize
      restoreState();
      setPainValue(Number(els.painInput.value) || 5, true);
      renderTaskReadinessForm();
      renderTaskList();
      setSaveMode();
      attachEvents();
      update();
    })();
  </script>
</body>
</html>
